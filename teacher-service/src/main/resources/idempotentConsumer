


@Transactional
public void handle(GradeCreatedEvent event) {

    if (processedRepository.existsById(event.getEventId())) {
        return; // уже обрабатывали
    }

    // делаем бизнес-логику
    sendEmail();

    processedRepository.save(
        new ProcessedEvent(event.getEventId())
    );
}







GradeCreatedEvent event = GradeCreatedEvent.builder()
    .eventId(UUID.randomUUID())
    .studentId(10L)
    .value(5)
    .build();